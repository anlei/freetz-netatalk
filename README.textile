h1. Netatalk

If you don't speak German but would like to work on this project, please let me know by adding a comment "in the forum":http://www.ip-phone-forum.de/showthread.php?p=1483609.


h2. Stand der Dinge

Alle Binaries kompilieren und werden korrekt installiert. Das CGI ist auch gemacht, Netatalk lässt sich also über das Freetz-Webinterface konfigurieren, starten und stoppen. Das Mounten als Gast oder als User ist möglich.


h2. Leute

Im Moment schrauben nur ich (Sven) und dg1kjd (Jens) an diesen Paketen. Um mit mir Kontakt aufzuznehmen, schreibe eine Reply "ins Forum":http://www.ip-phone-forum.de/showthread.php?p=1483609, schicke mir auf Github eine Message an "svoop" oder suche mich auf "IRC":http://trac.freetz.org/wiki/help/irc (nick: "svoop").


h2. Installation

Zuerst sollte das Git Repo geforked werden:
"http://github.com/svoop/freetz-netatalk":http://github.com/svoop/freetz-netatalk

Danach die Entwicklungsumgebung erzeugen. Anstelle von {USERNAME} sollte der eigene Github-Username eingesetzt werden:

pre. 
mkdir freetz
cd freetz
svn checkout http://svn.freetz.org/trunk
git clone git@github.com:{USERNAME}/freetz-netatalk.git netatalk
ln -s ../../netatalk trunk/make/
sed -i 's%ncftp/Config.in%ncftp/Config.in\nsource make/netatalk/Config.in%' trunk/make/Config.in
sed -i 's%enable-smallbuild%enable-smallbuild\n$(PKG)_CONFIGURE_OPTIONS += --with-mutex=MIPS/gcc-assembly%' trunk/make/libs/db.mk
cd trunk
make menuconfig

Die zweite sed-Zeile repariert die Konfiguration der libdb-4.8 (Berkeley-DB), die für das CNID_DBD frontend benötigt wird. Im aktuellen freetz trunk wird die libdb so konfiguriert, dass MUTEX Unterstützung nicht funktioniert. Dies wird hier korrigiert. Die libdb muss entsprechend neu gebaut werden.

h2. Pakete

pre. 
FREETZ_PACKAGE_NETATALK
  Package selection -> Testing -> Netatalk


h2. Shell

Wer lieber in der Shell herumprobiert, muss einmal Netatalk über das Webinterface starten und stoppen. Dadurch werden die folgenden Konfigurationsdateien angelegt und können danach direkt bearbeitet werden:

* /mod/etc/netatalk/afpd.conf
* /mod/etc/netatalk/AppleVolumes.default

Starten der Daemons:

pre.
  cnid_metad -s /sbin/cnid_dbd -l LOG_INFO
  afpd -F /mod/etc/netatalk/afpd.conf -f /mod/etc/netatalk/AppleVolumes.default -P /var/run/afpd.pid

Stoppen der Daemons:

pre.
  killall -SIGTERM afpd
  killall -SIGTERM cnid_metad


h2. Links

* "Forum":http://www.ip-phone-forum.de/showthread.php?p=1483609
* "Ticket":http://trac.freetz.org/ticket/671
* "IRC":http://trac.freetz.org/wiki/help/irc
* "Netatalk":http://netatalk.sourceforge.net
* "Github":http://help.github.com/forking
* "Netatalk auf OpenWRT":https://dev.openwrt.org/browser/packages/net/netatalk
